title: 折腾机房的老旧集群计算机
author: 1v4n-poi
tags:
  - Centos
  - Linux
categories:
  - 服务器管理
date: 2021-05-15 15:10:00
---
实验室的几台老旧集群计算机因为服务器升级变成了明日黄花（雾），机房断电多次重启之后能通ping，但远程ssh已经连接不上了。考虑到集群的性能还能用来做一些有限元计算、模型搭建和数据处理，刚接手服务器管理的我（垃圾佬）决定修复一下。

由于本身集群的计算机在前任管理员毕业前已经重装过Centos 7.0系统，为了避免重装软件带来的麻烦，首先考虑到是不是重启导致sshd服务关闭了（最后也验证了这个猜测）。于是找到前任管理员询问root账户的密码，然而，他告诉我他也忘记了_(:з」∠)_。

<!--more-->

好嘛，事情又变成了重置和修改root账户密码的问题。这里也是将操作留档记录一下。

1. 重启机器后按esc，选择 `CentOS Linux (3.10.0-693.......)` 按e键
2. 定位到 linux 16开头的行，找到 `ro` 并替换为 `rw init=sysroot/bin/sh` 之后按 ctrl+x 执行。
3. 之后输入 `chroot /sysroot`，再输入 `passwd` 后根据提示输入两次新密码
4. 输入 `touch /.autorelabel` 更新系统信息
5. 最后键入 `exit` 和 `reboot` 重启即完成密码重置与更改

进入root账户后，在Terminal下输入 `netstat -antulp | grep ssh` 确认22端口是否在LISTEN状态。

![listen](https://cdn.jsdelivr.net/gh/1v4n-poi/1v4n-poi.github.io@hexo/images/20210515/2.jpg)

如无上方提示则22端口Listen未启用，确认后检查sshd服务是否开启，输入 `ps -e | grep sshd`，下图为正常状态。

![sshd](https://cdn.jsdelivr.net/gh/1v4n-poi/1v4n-poi.github.io@hexo/images/20210515/3.jpg)

查看sshd状态 `systemctl status sshd`，正常情况是这样。

![sshd](https://cdn.jsdelivr.net/gh/1v4n-poi/1v4n-poi.github.io@hexo/images/20210515/4.jpg)

如果上述状态异常，输入 `systemctl restart sshd` 和 `systemctl restart sshd.service` 启用服务。

设置开机启用 `systemctl enable sshd.service`，大功告成。

如果有其他零星还问题可参阅[链接](https://my.oschina.net/prosouly/blog/1837799)。
